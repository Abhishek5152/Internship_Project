{% extends "admin/admin_layout.html" %}

{% block content %}
            <div class="page-content">
                <!-- Page Header-->
                <div class="page-header no-margin-bottom">
                <div class="container-fluid">
                    <h2 class="h5 no-margin-bottom">Budget</h2>
                </div>
                </div>
                <!-- Breadcrumb-->
                <div class="container-fluid">
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/dashboard">Home</a></li>
                    <li class="breadcrumb-item active">Budget</li>
                </ul>
                </div>
                <section class="no-padding-top">
                <div class="container-fluid">
                    <div class="row">
                    <div class="col-lg-12">
                        <div class="block">
                        <div class="title"><strong>Budget</strong></div>
                        <div class="table-responsive"> 
                            <table class="table table-striped table-hover">
                            <thead>
                                <tr>
                                <th>ID</th>
                                <th>Department</th>
                                <th>Category</th>
                                <th>Amount Limit</th>
                                <th>Start Date</th>
                                <th>End Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for bgt in budgets %}
                                <tr>
                                    <td>{{ bgt[0] }}</td>  <!-- ID -->
                                    <td>{{ bgt[1] }}</td>  <!-- Department -->
                                    <td>{{ bgt[2] }}</td>  <!-- Category -->
                                    <td>{{ "{:,}".format(bgt[3]|int) }}</td>  <!-- Amount Limit -->
                                    <td>{{ bgt[4].strftime('%d-%m-%Y') }}</td>  <!-- Start Date -->
                                    <td>{{ bgt[5].strftime('%d-%m-%Y') }}</td>  <!-- End Date -->
                                    <td>
                                        <button class="btn btn-sm btn-primary"
                                                data-toggle="modal"
                                                data-target="#editModal"
                                                data-id="{{ bgt[0] }}"
                                                data-dept="{{ bgt[1] }}"
                                                data-cat="{{ bgt[2] }}"
                                                data-amt="{{ bgt[3] }}"
                                                data-start="{{ bgt[4] }}"
                                                data-end="{{ bgt[5] }}">Edit
                                        </button>
                                        <a href="#" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this budget?');">Delete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                            </table>
                        </div>
                        </div>
                    </div>
                    </div>
                    </div>
                </div>
                </section>
                <!-- Edit Budget Modal -->
                <div class="modal fade" id="editModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                    <form method="POST" action="{{ url_for('update_budget') }}">
                        <div class="modal-header">
                        <h5 class="modal-title">Edit Budget</h5>
                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                        </div>

                        <div class="modal-body">

                        <input type="hidden" name="budget_id" id="edit_id">

                        <div class="form-group">
                            <label>Department</label>
                            <input type="text" name="department" id="edit_dept" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label>Category</label>
                            <select class="form-control" name="category" required data-msg ="Please select a budget category">
                                <option value="">Select Budget Category</option>
                                {% for cat in categories %}
                                    <option value="{{ cat[0] }}">{{ cat[1] }}</option>
                                {% endfor %}
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Amount Limit</label>
                            <input type="number" name="amt_lmt" id="edit_amt" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label>Start Date</label>
                            <input type="date" name="start_date" id="edit_start" class="form-control" required>
                        </div>

                        <div class="form-group">
                            <label>End Date</label>
                            <input type="date" name="end_date" id="edit_end" class="form-control" required>
                        </div>

                        </div>

                        <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Update</button>
                        </div>

                    </form>
                    </div>
                </div>
                </div>

{% endblock %}